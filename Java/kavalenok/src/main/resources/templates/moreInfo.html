<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Настройка профиля - VolleyPro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Roboto+Condensed:wght@700&display=swap"
          rel="stylesheet">
    <link th:href="@{/css/style.css}" rel="stylesheet">
    <link rel="icon" th:href="@{/img/favicon.jpg}">
</head>
<body>

<div th:replace="layout/header :: header"></div>

<div class="profile-setup-container">
    <div class="profile-setup-card">
        <div class="setup-header">
            <div class="setup-logo">
                <img th:src="@{/img/favicon.jpg}" alt="VolleyPro">
                <span class="setup-logo-text">VolleyPro</span>
            </div>
            <h2 class="mb-2">Заполните информацию о себе</h2>
            <p class="setup-subtitle">Расскажите о себе, чтобы другие участники могли вас узнать</p>
        </div>

        <div class="setup-body">
            <div th:if="${errorMessage}" class="alert alert-danger" role="alert">
                <i class="fas fa-exclamation-circle me-2"></i>
                <span th:text="${errorMessage}"></span>
            </div>


            <form th:action="@{/moreinfo}" method="post" enctype="multipart/form-data" id="profileForm">

                <div class="profile-avatar-section">
                    <h4 class="section-title mb-4">
                        <i class="fas fa-user-circle me-2"></i>Ваше фото
                    </h4>

                    <div class="avatar-upload-container">
                        <div class="avatar-preview mb-4 text-center">
                            <img id="avatarPreview"
                                 th:src="@{/img/avatars/1.png}"
                                 src="/img/avatars/1.png"
                                 alt="Предпросмотр аватара"
                                 class="avatar-image">
                        </div>

                        <div class="upload-options">
                            <div class="upload-option mb-4">
                                <div class="option-header mb-2">
                                    <i class="fas fa-cloud-upload-alt me-2 text-primary"></i>
                                    <h5 class="d-inline">Загрузить своё фото</h5>
                                </div>
                                <div class="custom-file-upload">
                                    <input type="file"
                                           id="avatarUpload"
                                           name="avatarFile"
                                           accept="image/*"
                                           class="form-control"
                                           onchange="previewAvatar(event)">
                                    <label for="avatarUpload" class="custom-file-label">
                                        <i class="fas fa-upload me-2"></i>
                                        Выберите файл
                                    </label>
                                    <div class="form-text">JPG, PNG до 5MB</div>
                                </div>
                            </div>

                            <div class="upload-option">
                                <div class="option-header mb-2">
                                    <i class="fas fa-images me-2 text-primary"></i>
                                    <h5 class="d-inline">Выбрать из готовых</h5>
                                </div>
                                <div class="default-avatars">
                                    <div class="row g-3">
                                        <div class="col-4 col-sm-3" th:each="i : ${#numbers.sequence(1, 12)}">
                                            <div class="default-avatar-option"
                                                 th:attr="data-avatar-index=${i}"
                                                 onclick="selectDefaultAvatar(this, ${i})">
                                                <img th:src="@{'/img/avatars/' + ${i} + '.png'}"
                                                     th:alt="|Аватар ${i}|"
                                                     class="default-avatar-img">
                                            </div>
                                        </div>
                                    </div>
                                    <input type="hidden" id="selectedDefaultAvatar" name="defaultAvatar">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="profile-info-section mt-5">
                    <h4 class="section-title mb-4">
                        <i class="fas fa-id-card me-2"></i>Личная информация
                    </h4>

                    <div class="row g-3">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="firstName" class="form-label">
                                    <i class="fas fa-user me-2"></i>Имя*
                                </label>
                                <input type="text"
                                       class="form-control"
                                       id="firstName"
                                       name="firstName"
                                       th:value="${firstName != null} ? ${firstName} : ''"
                                       placeholder="Ваше имя"
                                       required>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="lastName" class="form-label">
                                    Фамилия*
                                </label>
                                <input type="text"
                                       class="form-control"
                                       id="lastName"
                                       name="lastName"
                                       th:value="${lastName != null} ? ${lastName} : ''"
                                       placeholder="Ваша фамилия"
                                       required>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="middleName" class="form-label">
                                    Отчество
                                </label>
                                <input type="text"
                                       class="form-control"
                                       id="middleName"
                                       name="middleName"
                                       th:value="${middleName != null} ? ${middleName} : ''"
                                       placeholder="Ваше отчество">
                            </div>
                        </div>
                    </div>

                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="birthDate" class="form-label">
                                    <i class="fas fa-birthday-cake me-2"></i>Дата рождения*
                                </label>
                                <input type="date"
                                       class="form-control"
                                       id="birthDate"
                                       name="birthDate"
                                       th:value="${birthDate != null} ? ${birthDate} : ''">
                                <div class="form-text">
                                    Для участия в возрастных категориях
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="phone" class="form-label">
                                    <i class="fas fa-phone me-2"></i>Телефон*
                                </label>
                                <input type="tel"
                                       class="form-control"
                                       id="phone"
                                       name="phone"
                                       th:value="${phone != null} ? ${phone} : ''"
                                       placeholder="+375 (29) 123-45-67">
                                <div class="form-text">
                                    Для связи с командой
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                    <div class="d-flex justify-content-between">
                        <a th:href="@{/}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-2"></i>Пропустить
                        </a>
                        <button type="submit" class="btn btn-primary setup-btn">
                            <span id="submitText">Сохранить профиль</span>
                            <i class="fas fa-save ms-2"></i>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<div th:replace="layout/footer :: footer"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function previewAvatar(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('avatarPreview').src = e.target.result;
                document.getElementById('selectedDefaultAvatar').value = '';
            };
            reader.readAsDataURL(file);
        }
    }

    function selectDefaultAvatar(element, avatarIndex) {
        const allAvatars = document.querySelectorAll('.default-avatar-option');
        allAvatars.forEach(avatar => avatar.classList.remove('selected'));

        element.classList.add('selected');

        const avatarPreview = document.getElementById('avatarPreview');
        avatarPreview.src = `/img/avatars/${avatarIndex}.png`;

        document.getElementById('selectedDefaultAvatar').value = avatarIndex + '.png';

        document.getElementById('avatarUpload').value = '';
    }

    document.addEventListener('DOMContentLoaded', function() {
        const avatarOptions = document.querySelectorAll('.default-avatar-option');
        avatarOptions.forEach(option => {
            option.addEventListener('click', function() {
                const avatarIndex = this.getAttribute('data-avatar-index');
                selectDefaultAvatar(this, avatarIndex);
            });
        });
    });
</script>
</body>
</html>